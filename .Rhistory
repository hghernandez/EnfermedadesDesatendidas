ggplot(distr_edad,aes(x= edadquinq, fill= sexo ,y= ifelse(sexo== '1.Varones',n,-n)))+
geom_bar(stat= 'identity')+
scale_y_continuous(
labels = abs,
limits = max(distr_edad$n) * c(-1,1)
) +
scale_fill_manual(values=c("#E6F5D0","#F1B6DA"),labels=c("Varones","Mujeres"))+
scale_x_discrete(labels= substring(distr_edad$edadquinq,4,str_length(distr_edad$edadquinq)))+
coord_flip() +
theme_minimal() +
labs(
x = "Edad Quinquenal",
y = "Casos",
fill = "Sexo",
title = "Distribución de los casos por edad"
)
poblacion <- R.utils::loadObject("PoblacionesEstimadas/pobdeptos0125.Rbin")
View(poblacion)
poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
casos %>%
filter(sexo != '3.Ambos sexos' & edadquinq != '18.Total') %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n())
casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n())
casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo"))
casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n())
pob_agrup
fix_length <- function(x){
x <- ifelse(x < 10,paste0('0',x),as.character(x))
return(x)
}
fix_length <- function(x){
x <- ifelse(x < 10,paste0('0',x),as.character(x))
return(x)
}
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(as.numeric(susbtring(1,2,gredad)))))
View(poblacion %>%
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = as.numeric(susbtring(1,2,gredad))))
%>%
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = as.numeric(susbtring(1,2,gredad))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = as.numeric(susbtring(1,2,gredad))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = as.numeric(substring(1,2,gredad))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice =substring(1,2,gredad)))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice =substring(1,1,gredad)))
substring(poblacion$gredad,1,2)
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = as.numeric(substring(gredad,1,2))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(as.numeric(substring(gredad,1,2)))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(as.numeric(substring(gredad,1,2))),
gredad = paste0(indice,substring(gredad,4,str_length(gredad)))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(as.numeric(substring(gredad,1,2))),
gredad = paste0(indice,substring(gredad,2,str_length(gredad)))))
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(as.numeric(substring(gredad,1,2))),
gredad = paste0(indice,substring(gredad,3,str_length(gredad)))))
fix_length <- function(x){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',x),as.character(x))
return(x)
}
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(gredad)))
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),as.character(y))
return(x)
}
pob_agrup <-
View(poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(indice = fix_length(gredad,gredad)))
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo"))
RColorBrewer::brewer.pal.info
casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo"))
casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion)))
unique(poblacion$gredad)
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),as.character(y))
x <- ifelse(x == 17,paste0("17.",y),as.character(y))
return(x)
}
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
View(pob_agrup)
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),ifelse(x == 17,paste0("17.",y),as.character(y)))
return(x)
}
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),
ifelse(x == 17,"17.80 y +",as.character(y)))
return(x)
}
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion)))
library(tidyverse)
library(R.utils)
library(foreign)
library(sf)
library(epitools)
library(spdep)
load("datosMort/data.RData")
evento <- "18.Lepra"
enf <- casos %>%
filter(enf_desa_sub== evento)
pob_deptos <- loadObject("PoblacionesEstimadas/pobdeptos0125.Rbin")
pob_caba <- pob_deptos %>%
filter(codprov== 2) %>%
group_by(ano,codprov,sexo,gredad) %>%
summarise(poblacion= sum(poblacion))%>%
mutate(coddep= 000,
nomdep= 'Total CABA') %>%
as.data.frame()
pob_sin_caba <- pob_deptos %>%
filter(codprov!= 2) %>%
group_by(ano,codprov,coddep,nomdep,sexo,gredad) %>%
summarise(poblacion= sum(poblacion)) %>%
as.data.frame()
pob_deptos <- pob_caba %>%
bind_rows(pob_sin_caba)
fix_cod <- function(x){
x <- ifelse(stringr::str_length(x)== 1,paste0('00',x),
ifelse(stringr::str_length(x)== 2,paste0('0',x),as.character(x)))
return(x)
}
pob_deptos <- pob_deptos %>%
mutate(coddep= fix_cod(coddep),
codprov= ifelse(codprov < 10,paste0('0',codprov),codprov))
enf <- pob_deptos %>%
filter(ano >= 2004 & ano <= 2018) %>%
left_join(enf, by= c("ano","codprov"="provres","coddep"="depres","sexo","gredad"="edadquinq")) %>%
mutate(link= paste0(codprov,coddep)) %>%
fill(enf_desa_sub,.direction = "downup") %>%
fill(enf_desa_tot,.direction = "downup")
View(enf)
View(pob_deptos)
View(casos)
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),
ifelse(x == 17,"17.80 y +",
ifelse(x== 11,"11.50-54",
ifelse(x== 12,"12.55-59",as.character(y)))))
return(x)
}
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
poblacion <- R.utils::loadObject("PoblacionesEstimadas/pobdeptos0125.Rbin")
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),
ifelse(x == 17,"17.80 y +",
ifelse(x== 11,"11.50-54",
ifelse(x== 12,"12.55-59",as.character(y)))))
return(x)
}
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
View(pob_agrup)
load("datosMort/data.RData")
View(casos %>%
mutate(edadquinq= fix_length(edadquinq)))
View(casos %>%
mutate(edadquinq= fix_length(edadquinq,edadquinq)))
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- #ifelse(x < 10,paste0('0',y),
#ifelse(x == 17,"17.80 y +",
ifelse(x== 11,"11.50-54",
ifelse(x== 12,"12.55-59",as.character(y)))
#))
return(x)
}
View(casos %>%
mutate(edadquinq= fix_length(edadquinq,edadquinq)))
casos <- casos %>%
mutate(edadquinq= fix_length(edadquinq,edadquinq))
save(casos, file="datosMort/data.RData")
load("datosMort/data.RData")
distr_edad <- casos %>%
filter(sexo != '3.Ambos sexos' & edadquinq != '18.Total') %>%
group_by(edadquinq,sexo) %>%
summarise(n= n()) %>%
arrange(sexo)
ggplot(distr_edad,aes(x= edadquinq, fill= sexo ,y= ifelse(sexo== '1.Varones',n,-n)))+
geom_bar(stat= 'identity')+
scale_y_continuous(
labels = abs,
limits = max(distr_edad$n) * c(-1,1)
) +
scale_fill_manual(values=c("#E6F5D0","#F1B6DA"),labels=c("Varones","Mujeres"))+
scale_x_discrete(labels= substring(distr_edad$edadquinq,4,str_length(distr_edad$edadquinq)))+
coord_flip() +
theme_minimal() +
labs(
x = "Edad Quinquenal",
y = "Casos",
fill = "Sexo",
title = "Distribución de los casos por edad"
)
poblacion <- R.utils::loadObject("PoblacionesEstimadas/pobdeptos0125.Rbin")
fix_length <- function(x,y){
x <- as.numeric(substring(x,1,2))
x <- ifelse(x < 10,paste0('0',y),
ifelse(x == 17,"17.80 y +",
ifelse(x== 11,"11.50-54",
ifelse(x== 12,"12.55-59",as.character(y)))))
return(x)
}
pob_agrup <- poblacion %>%
filter(ano >= 2004 & ano <= 2018)%>%
mutate(gredad = fix_length(gredad,gredad)) %>%
group_by(ano,gredad,sexo)%>%
summarise(poblacion= sum(poblacion))
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion)))
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion))
d= 19
p=1002416
t= d/p
t
round(d * (1 - (1/(9*d)) - (1.96/3) * sqrt(1/d)), 3) / p
d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3)/p
d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
d= 19
p=1002416
t= d*1000000/p
round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
round(d * (1 - (1/(9*d)) - (1.96/3) * (1/d)^(1/2))^3 / p, 3)
round(d * (1 - (1/(9*d)) - (1.96/3) * (1/d)^(1/2))^3 / p, 3)*1000000
d * (1 - (1/(9*d)) - (1.96/3) * (1/d)^(1/2))^3 / p
conf_interval <- function(d,p,t){
li= round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
ls= round((d+1)*((1 -(1/(9*(d+1))) - (1.96/3)* sqrt(1/(d+1))))^3/p,3)
}
conf_interval <- function(d,p,t){
li= round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
ls= round((d+1)*((1 -(1/(9*(d+1))) - (1.96/3)* sqrt(1/(d+1))))^3/p,3)
retun(li,ls)
}
d= 19
p=1002416
t= d/p
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
ls= round((d+1)*((1 -(1/(9*(d+1))) - (1.96/3)* sqrt(1/(d+1))))^3/p,3)
return(li,ls)
}
d= 19
p=1002416
t= d/p
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
ls= round((d+1)*((1 -(1/(9*(d+1))) - (1.96/3)* sqrt(1/(d+1))))^3/p,3)
return(li)
return(ls)
}
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= round(d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p,3)
ls= round((d+1)*((1 -(1/(9*(d+1))) - (1.96/3)* sqrt(1/(d+1))))^3/p,3)
return(c(li,ls))
}
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
ls= (d+1)*((1 -(1/(9*(d+1))) - (1.96/3)* sqrt(1/(d+1))))^3/p
return(c(li,ls))
}
d= 19
p=1002416
t= d/p
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
ls= (d+1) * ((1 - (1/(9*(d+1))) - (1.96/3) * sqrt(1/(d+1))))^3 / p
return(c(li,ls))
}
d= 19
p=1002416
t= d/p
conf_interval(d,p,t)
d= 41
p= 7211
t= 0.005686
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
ls= (d+1) * (1 - (1/(9*(d+1))) - (1.96/3) * sqrt(1/(d+1))) / p
return(c(li,ls))
}
d= 41
p= 7211
t= 0.005686
conf_interval(d,p,t)
conf_interval <- function(d,p,t){
li= d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
ls= (d+1) * ((1 - (1/(9*(d+1))) + (1.96/3) * sqrt(1/(d+1))))^3 / p
return(c(li,ls))
}
d= 41
p= 7211
t= 0.005686
conf_interval <- function(d,p){
li= d*((1 -(1/(9*d)) - (1.96/3)* sqrt(1/d)))^3/p
ls= (d+1) * ((1 - (1/(9*(d+1))) + (1.96/3) * sqrt(1/(d+1))))^3 / p
return(c(li,ls))
}
d= 41
p= 7211
t= 0.005686
conf_interval(d,p)
p=conf_interval(d,p)
p[1]
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion,
li= conf_interval(casos,poblacion)*1000000))
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion,
li= conf_interval(casos,poblacion)[1]))
View(casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion,
li= conf_interval(casos,poblacion)[1]*1000000))
tasas_esp <- casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion)
tasas_esp <- casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion) %>%
ungroup()%>%
mutate(li= conf_interval(casos,poblacion)[1]*1000000)
View(tasas_esp)
tasas_esp <- casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion) %>%
ungroup()%>%
mutate(li= apply(conf_interval(casos,poblacion)[1]*1000000,1))
tasas_esp <- casos %>%
group_by(ano,edadquinq,sexo) %>%
summarise(casos= n()) %>%
left_join(pob_agrup,by= c("ano","edadquinq"="gredad","sexo")) %>%
group_by(edadquinq,sexo)%>%
summarise(casos= sum(casos),
poblacion= sum(poblacion))%>%
mutate(tasa= casos*1000000/poblacion)
apply(X = tasas_esp,FUN = conf_interval(casos,poblacion)[1],MARGIN = 1)
apply(X = tasas_esp,FUN = conf_interval(casos,poblacion),MARGIN = 1)
apply(X = tasas_esp,FUN = conf_interval(tasas_esp$casos,tasas_esp$poblacion),MARGIN = 1)
nrow(tasas_esp)
tasas_esp$casos[1]
tasas_esp$casos[1]
for(i in 1:nrow(tasas_esp)){
tasas_esp[i,6] <- conf_interval(tasas_esp$casos[i],tasas_esp$poblacion[i])[1]*1000000
tasas_esp[i,7] <- conf_interval(tasas_esp$casos[i],tasas_esp$poblacion[i])[2]*1000000
}
colnames(tasas_esp)[6] <- "IC_inf"
colnames(tasas_esp)[6] <- "IC_sup"
View(tasas_esp)
colnames(tasas_esp)[6] <- "IC_inf"
colnames(tasas_esp)[7] <- "IC_sup"
